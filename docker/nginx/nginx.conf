events {}

http {
    upstream api_service {
        server api-service:8000;
    }
    upstream telemetry_service {
        server telemetry-service:8001;
    }
    upstream rule_engine_service {
        server rule-engine-service:8002;
    }
    upstream analytics_service {
        server analytics-service:8003;
    }
    upstream reporting_service {
        server reporting-service:8004;
    }
    upstream notification_service {
        server notification-service:8005;
    }
    upstream emqx_dashboard {
        server emqx:18083;
    }
    upstream minio_console {
        server minio:9090;
    }
    upstream grafana {
        server grafana:3000;
    }

    server {
        listen 80;

        # Direct API
        location /api/v1/ {
            proxy_pass http://api_service/api/v1/;
        }

        # Telemetry Ingest
        location /telemetry/ {
            proxy_pass http://telemetry_service/;
        }

        # Dashboard / Console Proxies
        location /dashboard/emqx/ {
            proxy_pass http://emqx_dashboard/;
        }
        
        location /dashboard/minio/ {
            proxy_pass http://minio_console/;
        }
        
        location /dashboard/grafana/ {
            proxy_pass http://grafana/;
        }
    }
}
